var $page,$weak,$icon,clockIntervals=[];$(".ui-page").live("pagecreate",function(a){$weak=$(".weak");$icon=$(".icon");$page=$(this);reset();$(".more").bind("vclick",function(){$(this).find("h3").hide()});$icon.bind("vclick",function(){var a=$icon.data("status"),b=$weak.val();if(a=="unlocked"){reset()}else if(a!="loading"&&b!=""){whisper(b)}});$weak.bind("keydown",function(a){var b=$icon.data("status"),c=$weak.val();if(a.keyCode=="13"&&b!="loading"){clearIntervals();whisper(c)}});$page.find(".length").bind("change",function(){if(!$page.find(".strong-1").data("v"))return;var a,b;a=$page.find(".length:checked").val();$page.find(".strong").each(function(){b=$(this).data("v");$(this).html(b.substring(0,a))})});$("#enable-settings").bind("change",function(){enableSettings($(this).is(":checked"));localStorage[$(this).attr("id")]=$(this).is(":checked")})});$(".ui-page").live("pagebeforeshow",function(){$page=$($.mobile.activePage);$weak=$page.find(".weak");$icon=$page.find(".icon");setStatus("locked");if(localStorage["default-password"]!=""){$weak.val(localStorage["default-password"])}if(localStorage["default-length"]=="true"){$page.find(".length-0").attr("checked",localStorage["default-length-0"]=="true").checkboxradio("refresh");$page.find(".length-1").attr("checked",localStorage["default-length-1"]=="true").checkboxradio("refresh");$page.find(".length-2").attr("checked",localStorage["default-length-2"]=="true").checkboxradio("refresh")}if(localStorage["auto-retrieve"]=="true"){whisper($weak.val())}$("#settings input[type='number']").css({opacity:.3}).slider("disable");if(localStorage["enable-settings"]=="true"){$("#enable-settings").attr("checked",true).checkboxradio("refresh");enableSettings(true)}});$(".ui-page").live("pageshow",function(){setTimeout(function(){$weak.focus()},1)});enableSettings=function(a){$settings=$("#settings");if(a){$settings.find("input[type='password']").textinput("enable");$settings.find("input[type='number']").css({opacity:1}).slider("enable");$settings.find("input[type='checkbox'], #settings input[type='radio']").checkboxradio("enable");$settings.find("input[type='password'], input[type='number']").each(function(){if(typeof localStorage[$(this).attr("id")]!="undefined")$(this).val(localStorage[$(this).attr("id")])});$settings.find("input[type='checkbox'], #settings input[type='radio']").each(function(){if(typeof localStorage[$(this).attr("id")]!="undefined")$(this).attr("checked",localStorage[$(this).attr("id")]=="true").checkboxradio("refresh")});$settings.find("input[type='password'], input[type='number']").bind("change",function(){localStorage[$(this).attr("id")]=$(this).val()});$settings.find("input[type='radio']").bind("change",function(){$(this).parents(".ui-controlgroup").find("input[type='radio']").each(function(){localStorage[$(this).attr("id")]=$(this).is(":checked")});localStorage[$(this).parents(".ui-controlgroup").attr("id")]=true});$settings.find("input[type='checkbox']").bind("change",function(){localStorage[$(this).attr("id")]=$(this).is(":checked")});$settings.find("#auto-hide-time").bind("change",function(){$settings.find(".auto-hide-time").html($(this).val())});$settings.find("input").trigger("change")}else{$settings.find("input[type='password']").textinput("disable").unbind("change");$settings.find("input[type='number']").slider("disable").css({opacity:.3}).unbind("change");$settings.find("input[type='radio'], #settings input[type='checkbox']").checkboxradio("disable").unbind("change");localStorage.clear()}};whisper=function(a){if($page.find(".i-agree").is(":checked")){setStatus("loading");$.ajax({type:"POST",url:"/whisper",data:"weak="+a,success:function(a){showPasswords(a)}})}};showPasswords=function(a){var b,c,d,e,f;c=$page.find(".length:checked").val();for(d=0,e=a.length;d<e;d++){b=a[d];$page.find(".strong-"+d).removeClass("strong-placeholder").data("v",b).html(b.substring(0,c))}setStatus("unlocked");f=$page.find(".clock");if(typeof localStorage["auto-hide"]!="undefined"){if(localStorage["auto-hide"]=="true"){if(typeof localStorage["auto-hide-time"]!="undefined"){e=localStorage["auto-hide-time"]}}else{return}}else{e=60}d=e;f.html(d);clockIntervals.push(setInterval(function(){d--;f.html(d);if(d==e/2){f.show().siblings().hide()}if(d<=0){reset()}},1e3))};reset=function(){setStatus("locked");clearIntervals();$(".weak").val("");$(".strong").each(function(){$(this).addClass("strong-placeholder").data("v","").html($(this).data("placeholder"))})};clearIntervals=function(){var a=clockIntervals.pop();while(typeof a!="undefined"){clearInterval(a);a=clockIntervals.pop()}};setStatus=function(a){if(a=="locked"){$icon.data("status","locked").children().hide().filter(".locked").show().addClass("pointer")}else if(a=="loading"){$icon.data("status","loading").children().hide().filter(".loading").show().removeClass("pointer")}else if(a=="unlocked"){$icon.data("status","unlocked").children().hide().filter(".unlocked").show().addClass("pointer")}}